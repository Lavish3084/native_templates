{% extends "page.html" %}
{% block nav_bar %}{% endblock nav_bar %}
{% set show_login = show_login | default(True) %}
{% set show_signup = show_signup | default(False) %}

{% block main %}
<style>
  :root {
    --brand-color: #000000;
    --text-primary: #ffffff;
    --text-secondary: rgba(255,255,255,0.7);
    --background-color: #000000;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Playfair Display', 'Georgia', serif;
    background-color: var(--background-color);
    color: var(--text-primary);
    overflow: hidden;
  }

  .video-background-fullscreen {
    position: fixed;
    inset: 0;
    z-index: 0;
    background-image: url('static/aispacebg.svg');
    background-size: cover;
    background-position: center;
  }

  .gradient-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0.4));
    z-index: 1;
  }

  .login-container-overlay {
    position: relative;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 60vh;
    width: 100vw;
    gap: 60px;
    padding: 0 60px;
    box-sizing: border-box;
    color: var(--text-primary);
    transition: all 0.8s ease-in-out; 
    margin-bottom: 500px;
  }

  .login-image-section {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.8s ease-in-out;
  }

  .login-image-section img {
    max-width: 60%;
    max-height: 500px;
    border-radius: 16px;
    object-fit: cover;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  }

  .login-form-container {
    flex: 0 0 400px;
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(12px);
    padding: 40px 50px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 500px;
    box-sizing: border-box;
    transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
  }

  /* Flip forms */
  .login-container-overlay.flipped .login-form-container {
    transform: translateX(-250%);
  }
  .login-container-overlay.flipped .login-image-section {
    transform: translateX(50%);
  }

  .login-header h1, .login-header p, label { color: #fff; }
  .form-group { margin-bottom: 18px; }
  .form-control {
    width: 100%;
    padding: 14px 16px;
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 8px;
    font-size: 15px;
    background-color: rgba(255,255,255,0.15);
    color: #fff;
  }
  .form-control::placeholder { color: rgba(255,255,255,0.7); }
  .form-control:focus {
    border-color: var(--brand-color);
    outline: none;
    background-color: rgba(255,255,255,0.25);
  }

  .btn-submit {
    width: 100%;
    padding: 14px 24px;
    border-radius: 8px;
    border: none;
    background-color: var(--brand-color);
    color: #fff;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    margin-top: 10%;
  }
  .btn-submit:hover { background-color: #222; }

  .signup-link {
    text-align: center;
    margin-top: 16px;
    font-size: 14px;
    color: var(--text-secondary);
  }
  .signup-link a { color: #fff; font-weight: 500; text-decoration: none; }
  .signup-link a:hover { opacity: 0.8; }

  .login_error {
    background-color: rgba(255,0,0,0.2);
    color: #fff;
    border: 1px solid rgba(255,0,0,0.5);
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 16%;
    text-align: center;
  }

  @media (max-width: 900px) {
    .login-container-overlay {
      flex-direction: column;
      gap: 40px;
      padding: 40px 20px;
    }
    .login-image-section img { max-width: 80%; max-height: 300px; }
    .login-form-container { width: 100%; max-width: 400px; flex: none; transform: translateX(0) !important; }
  }
</style>

<div class="video-background-fullscreen">
  <div class="gradient-overlay"></div>
</div>

<div class="login-container-overlay">

  <!-- Left image -->
  <div class="login-image-section">
    <img src="static/AI_Space_Logo_White.svg" alt="Illustration" />
  </div>

  <!-- Right form -->
  <div class="login-form-container">

    <!-- Sign In Form -->
    <div id="sign-in-wrapper" style="{% if not show_login %}display:none;{% endif %}">
      <div class="login-header">
        <h1>Welcome Back</h1>
        <p>Enter your username and password to access your account</p>
      </div>

      <form id="login-form" action="{{ authenticator_login_url|safe }}" method="post">
        <input type="hidden" name="_xsrf" value="{{ xsrf }}">
        {% if login_error %}<div class="login_error">{{ login_error }}</div>{% endif %}
        <div class="form-group">
          <label>Username</label>
          <input type="text" name="username" class="form-control" placeholder="Enter your username" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" name="password" class="form-control" placeholder="Enter your password" required>
        </div>
        <input type="submit" class="btn-submit" value="Sign In">
        {% if enable_signup %}
        <div class="signup-link">
          Don't have an account? <a href="#" id="toggle-signup">Sign Up</a>
        </div>
        {% endif %}
      </form>
    </div>

    <!-- Sign Up Form -->
    <div id="sign-up-wrapper" style="{% if not show_signup %}display:none;{% endif %}">
      <div class="login-header">
        <h1>Create Account</h1>
        <p>Fill in your details to get started</p>
      </div>

      <form id="signup-form" action="signup" method="post" onsubmit="return submitSignupForm(event)">
        <input type="hidden" name="_xsrf" value="{{ xsrf }}">
        {% if alert %}<div class="login_error">{{ result_message }}</div>{% endif %}

        <div class="form-group">
          <label>Username</label>
          <input type="text" name="username" class="form-control" value="{{username}}" required>
        </div>
        {% if ask_email %}
        <div class="form-group">
          <label>Email</label>
          <input type="email" name="email" class="form-control" value="{{email}}" required>
        </div>
        {% endif %}
        <div class="form-group">
          <label>Password</label>
          <div style="display:flex;gap:6px;">
            <input type="password" id="password_input" name="signup_password" class="form-control">
            <button id="eye" type="button" style="border:0;background:none;font-size:18px;cursor:pointer;">üëÅ</button>
          </div>
        </div>
        <div class="form-group">
          <label>Confirm Password</label>
          <input type="password" id="password_confirmation_input" name="signup_password_confirmation" class="form-control">
        </div>
        {% if two_factor_auth %}
        <div class="form-group">
          <input type="checkbox" name="2fa"> Enable Two-Factor Authentication
        </div>
        {% endif %}
        {% if tos %}
        <div class="form-group">
          <input type="checkbox" id="tos_check"> {{ tos|safe }}
        </div>
        {% endif %}
        {% if recaptcha_key %}
        <div class="form-group">
          <div class="g-recaptcha" data-sitekey="{{ recaptcha_key }}"></div>
        </div>
        {% endif %}
        <input type="submit" class="btn-submit" value="Create Account" {% if tos %}disabled{% endif %}>
        <div class="signup-link">
          Already have an account? <a href="#" id="toggle-login">Sign In</a>
        </div>
      </form>
    </div>

  </div>
</div>

{% endblock main %}

{% block script %}
<script>
document.addEventListener('DOMContentLoaded', function() {

  // Password toggle
  const eyeBtn = document.getElementById('eye');
  if(eyeBtn){
    eyeBtn.addEventListener('click', function(){
      const pwd = document.getElementById('password_input');
      const pwdc = document.getElementById('password_confirmation_input');
      if(pwd.type==='password'){
        pwd.type='text'; pwdc.type='text'; eyeBtn.textContent='üîë';
      } else { pwd.type='password'; pwdc.type='password'; eyeBtn.textContent='üëÅ'; }
    });
  }

  // Flip animation toggle
  const container = document.querySelector(".login-container-overlay");
  const signInWrapper = document.getElementById("sign-in-wrapper");
  const signUpWrapper = document.getElementById("sign-up-wrapper");

  document.getElementById("toggle-signup")?.addEventListener("click", e => {
    e.preventDefault();
    container.classList.add("flipped");
    signInWrapper.style.display = "none";
    signUpWrapper.style.display = "block";
  });

  document.getElementById("toggle-login")?.addEventListener("click", e => {
    e.preventDefault();
    container.classList.remove("flipped");
    signUpWrapper.style.display = "none";
    signInWrapper.style.display = "block";
  });

  {% if tos %}
  const tosCheck = document.getElementById('tos_check');
  if(tosCheck){
    tosCheck.addEventListener('click', function(){
      document.querySelector('#signup-form .btn-submit').disabled = !tosCheck.checked;
    });
  }
  {% endif %}
});
</script>
{% if recaptcha_key %}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endif %}
{% endblock script %}
